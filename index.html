<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tahoe Snow Report</title>
  <meta name="description" content="Snow report dashboard for Lake Tahoe ski resorts." />
  <style>
    :root{--bg:#0b1220;--card:#121b2e;--muted:#9fb0d0;--text:#e8eefc;--accent:#7dd3fc;--good:#34d399;--warn:#fbbf24;--bad:#fb7185;--border:rgba(255,255,255,.08)}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:radial-gradient(1200px 600px at 20% 0%,rgba(167,139,250,.25),transparent 60%),radial-gradient(900px 500px at 80% 10%,rgba(125,211,252,.22),transparent 55%),var(--bg);color:var(--text)}
    header{padding:28px 18px 10px;max-width:1100px;margin:0 auto}
    h1{margin:0 0 6px;font-size:28px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:14px;line-height:1.4}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:14px}
    .pill{border:1px solid var(--border);background:rgba(255,255,255,.03);padding:8px 10px;border-radius:999px;font-size:13px;color:var(--muted)}
    .pill b{color:var(--text);font-weight:600}
    main{max-width:1100px;margin:0 auto;padding:14px 18px 40px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .card{grid-column:span 6;background:rgba(18,27,46,.9);border:1px solid var(--border);border-radius:16px;padding:14px 14px 12px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    @media (max-width:860px){.card{grid-column:span 12}}
    .top{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .name{font-size:18px;margin:0}
    .meta{color:var(--muted);font-size:12px;margin-top:4px}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--muted);white-space:nowrap}
    .badge.good{color:var(--good)}
    .badge.warn{color:var(--warn)}
    .badge.bad{color:var(--bad)}
    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
    .stat{border:1px solid var(--border);border-radius:14px;padding:10px;background:rgba(255,255,255,.02)}
    .stat .k{color:var(--muted);font-size:12px}
    .stat .v{font-size:18px;margin-top:4px}
    .links{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    footer{max-width:1100px;margin:0 auto;padding:0 18px 26px;color:var(--muted);font-size:12px}
    .note{border-top:1px solid var(--border);padding-top:14px;margin-top:18px;line-height:1.5}
    .small{font-size:11px;opacity:.95}
    .err{color:var(--bad)}
  </style>
</head>
<body>
  <header>
    <h1>Tahoe Snow Report</h1>
    <div class="sub">This page renders resort snow stats from <code>data/snow.json</code>. Update that JSON and the dashboard updates. No backend required.</div>
    <div class="bar">
      <div class="pill">Last updated: <b id="updated">—</b></div>
      <div class="pill">Source: <b id="source">—</b></div>
      <div class="pill">Status: <b id="status">Loading…</b></div>
    </div>
  </header>

  <main>
    <div id="grid" class="grid"></div>
    <div class="note small">
      <div><b>Heads up:</b> This repo ships with placeholder values. Wire <code>data/snow.json</code> to your preferred provider (or a scheduled job) for real numbers.</div>
    </div>
  </main>

  <footer>
    <div class="note">
      <div><b>Disclaimer:</b> Verify conditions with the resort before you plan your day.</div>
    </div>
  </footer>

<script>
  const fmtIn = (n) => (n === null || n === undefined || n === '') ? '—' : `${n}"`;
  const fmtPct = (n) => (n === null || n === undefined || n === '') ? '—' : `${n}%`;
  const badgeClass = (snow24) => {
    if (snow24 === null || snow24 === undefined) return '';
    if (snow24 >= 6) return 'good';
    if (snow24 >= 2) return 'warn';
    return 'bad';
  };

  function card(resort){
    const el = document.createElement('section');
    el.className = 'card';

    const snow24 = resort.snow_24h_in;
    const badge = document.createElement('div');
    badge.className = `badge ${badgeClass(snow24)}`;
    badge.textContent = (snow24 === null || snow24 === undefined) ? '24h: —' : `24h: ${snow24}"`;

    el.innerHTML = `
      <div class="top">
        <div>
          <h2 class="name">${resort.name}</h2>
          <div class="meta">${resort.region || 'Lake Tahoe'} • Elevation: ${resort.elevation_ft ?? '—'} ft</div>
        </div>
      </div>
      <div class="stats">
        <div class="stat"><div class="k">24h snow</div><div class="v">${fmtIn(resort.snow_24h_in)}</div></div>
        <div class="stat"><div class="k">72h snow</div><div class="v">${fmtIn(resort.snow_72h_in)}</div></div>
        <div class="stat"><div class="k">Base depth</div><div class="v">${fmtIn(resort.base_depth_in)}</div></div>
        <div class="stat"><div class="k">Open trails</div><div class="v">${resort.trails_open ?? '—'} / ${resort.trails_total ?? '—'}</div></div>
        <div class="stat"><div class="k">Open lifts</div><div class="v">${resort.lifts_open ?? '—'} / ${resort.lifts_total ?? '—'}</div></div>
        <div class="stat"><div class="k">Terrain open</div><div class="v">${fmtPct(resort.terrain_open_pct)}</div></div>
      </div>
      <div class="links">
        ${resort.report_url ? `<a href="${resort.report_url}" target="_blank" rel="noopener">Official report</a>` : ''}
        ${resort.webcam_url ? `<a href="${resort.webcam_url}" target="_blank" rel="noopener">Webcams</a>` : ''}
      </div>
    `;

    el.querySelector('.top').appendChild(badge);
    return el;
  }

  async function load(){
    const status = document.getElementById('status');
    try{
      const res = await fetch('./data/snow.json', {cache:'no-store'});
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      document.getElementById('updated').textContent = data.updated_at || '—';
      document.getElementById('source').textContent = data.source || '—';
      status.textContent = 'OK';

      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      (data.resorts || []).forEach(r => grid.appendChild(card(r)));

      if(!data.resorts || data.resorts.length === 0){
        grid.innerHTML = `<div class="err">No resorts found in /api/snow.</div>`;
      }
    }catch(e){
      status.textContent = 'Error';
      document.getElementById('grid').innerHTML = `<div class="err">Failed to load /api/snow: ${e.message}</div>`;
    }
  }

  load();
</script>
</body>
</html>
